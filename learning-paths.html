<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Paths - CodonCanvas</title>
    <link rel="stylesheet" href="css/learning-paths.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üß¨ Learning Paths</h1>
        <p class="subtitle">
          Guided journeys through CodonCanvas - from genetic fundamentals to
          mathematical beauty
        </p>
      </header>

      <div id="pathSelector" class="path-selector">
        <!-- Paths will be rendered here -->
      </div>

      <div id="pathViewer" class="path-viewer">
        <a href="#" id="backButton" class="back-button">‚Üê Back to Paths</a>

        <div class="progress-text">
          Step <span id="currentStep">1</span> of <span id="totalSteps">6</span>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>

        <div id="stepContent" class="step-content">
          <!-- Step content will be rendered here -->
        </div>

        <div class="navigation">
          <button id="prevButton" class="nav-button">‚Üê Previous</button>
          <button id="nextButton" class="nav-button">Next ‚Üí</button>
        </div>
      </div>
    </div>

    <script type="module">
      let pathsData = null;
let currentPath = null;
let currentStepIndex = 0;

async function loadPaths() {
  const response = await fetch("examples/learning-paths.json");
  pathsData = await response.json();
  renderPathSelector();
}

function renderPathSelector() {
  const container = document.getElementById("pathSelector");
  container.innerHTML = pathsData.paths
    .map(
      (path) => `
        <div class="path-card" data-path-id="${path.id}">
          <div class="path-title">${path.title}</div>
          <div class="path-meta">
            <span class="difficulty ${
              path.difficulty
            }">${path.difficulty.replace(/-/g, " ")}</span>
            <span>‚è± ${path.duration}</span>
          </div>
          <div class="path-description">${path.description}</div>
          <div class="objectives">
            <div class="objectives-title">Learning Objectives:</div>
            <ul>
              ${path.learningObjectives
                .map((obj) => `<li>${obj}</li>`)
                .join("")}
            </ul>
          </div>
        </div>
      `,
    )
    .join("");

  // Add click handlers
  document.querySelectorAll(".path-card").forEach((card) => {
    card.addEventListener("click", () => {
      const pathId = card.dataset.pathId;
      startPath(pathId);
    });
  });
}

function startPath(pathId) {
  currentPath = pathsData.paths.find((p) => p.id === pathId);
  currentStepIndex = 0;

  // Hide selector, show viewer
  document.getElementById("pathSelector").style.display = "none";
  document.getElementById("pathViewer").classList.add("active");

  // Set total steps
  document.getElementById("totalSteps").textContent = currentPath.steps.length;

  // Render first step
  renderStep();
}

function renderStep() {
  const step = currentPath.steps[currentStepIndex];
  const stepContent = document.getElementById("stepContent");

  stepContent.innerHTML = `
        <div class="step-header">
          <h2 class="step-title">${step.title}</h2>
          <div class="step-concept">${step.concept}</div>
        </div>

        <div class="narrative">
          ${step.narrative}
        </div>

        <div class="key-takeaway">
          <strong>üí° Key Takeaway:</strong> ${step.keyTakeaway}
        </div>

        <div class="try-it">
          <strong>üß™ Try It:</strong> ${step.tryIt}
        </div>

        <a href="index.html?example=${step.genome.replace(
          ".genome",
          "",
        )}" class="genome-link" target="_blank">
          üß¨ Open ${step.genome} in Playground ‚Üí
        </a>
      `;

  // Update progress
  const progress = ((currentStepIndex + 1) / currentPath.steps.length) * 100;
  document.getElementById("progressFill").style.width = `${progress}%`;
  document.getElementById("currentStep").textContent = currentStepIndex + 1;

  // Update navigation buttons
  document.getElementById("prevButton").disabled = currentStepIndex === 0;
  document.getElementById("nextButton").disabled =
    currentStepIndex === currentPath.steps.length - 1;

  // Change "Next" to "Complete" on last step
  if (currentStepIndex === currentPath.steps.length - 1) {
    document.getElementById("nextButton").textContent = "‚úì Complete Path";
  } else {
    document.getElementById("nextButton").textContent = "Next ‚Üí";
  }
}

function nextStep() {
  if (currentStepIndex < currentPath.steps.length - 1) {
    currentStepIndex++;
    renderStep();
    window.scrollTo({ top: 0, behavior: "smooth" });
  } else {
    // Path completed
    alert(
      `üéâ Congratulations! You've completed the "${
        currentPath.title
      }" learning path!\n\nYou've learned:\n${currentPath.learningObjectives
        .map((obj, i) => `${i + 1}. ${obj}`)
        .join(
          "\n",
        )}\n\nExplore another path or start creating your own genomes!`,
    );
    backToSelector();
  }
}

function prevStep() {
  if (currentStepIndex > 0) {
    currentStepIndex--;
    renderStep();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
}

function backToSelector() {
  document.getElementById("pathViewer").classList.remove("active");
  document.getElementById("pathSelector").style.display = "grid";
  currentPath = null;
  currentStepIndex = 0;
}

// Event listeners
document.getElementById("nextButton").addEventListener("click", nextStep);
document.getElementById("prevButton").addEventListener("click", prevStep);
document.getElementById("backButton").addEventListener("click", (e) => {
  e.preventDefault();
  if (
    confirm(
      "Are you sure you want to exit this learning path? Your progress will not be saved.",
    )
  ) {
    backToSelector();
  }
});

// Keyboard navigation
document.addEventListener("keydown", (e) => {
  if (currentPath) {
    if (
      e.key === "ArrowRight" &&
      currentStepIndex < currentPath.steps.length - 1
    ) {
      nextStep();
    } else if (e.key === "ArrowLeft" && currentStepIndex > 0) {
      prevStep();
    }
  }
});

// Initialize
loadPaths();
    </script>
  </body>
</html>
