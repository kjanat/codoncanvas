<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodonCanvas - Timeline Scrubber Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: #252526;
      padding: 1.5rem;
      border-radius: 4px;
      margin-bottom: 1rem;
      border: 1px solid #3e3e42;
    }

    h1 {
      font-size: 1.75rem;
      color: #4ec9b0;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      font-size: 0.875rem;
      color: #858585;
    }

    .main-content {
      display: grid;
      gap: 1rem;
    }

    .panel {
      background: #252526;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      overflow: hidden;
    }

    .panel-header {
      background: #2d2d30;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #3e3e42;
      font-weight: bold;
      font-size: 0.875rem;
    }

    .panel-content {
      padding: 1rem;
    }

    .editor-section {
      margin-bottom: 1rem;
    }

    #editor {
      width: 100%;
      min-height: 120px;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      resize: vertical;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.875rem;
      font-family: inherit;
      transition: background 0.2s;
    }

    button:hover {
      background: #1177bb;
    }

    button.secondary {
      background: #3e3e42;
    }

    button.secondary:hover {
      background: #505052;
    }

    .canvas-container {
      display: flex;
      justify-content: center;
      padding: 1rem;
      background: #1e1e1e;
      border-radius: 4px;
      min-height: 400px;
    }

    canvas {
      border: 1px solid #3e3e42;
      background: white;
      border-radius: 4px;
    }

    .info-box {
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .info-box h3 {
      color: #4ec9b0;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .info-box p {
      font-size: 0.875rem;
      line-height: 1.6;
      color: #858585;
    }

    .status {
      padding: 0.75rem 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .status.success {
      background: rgba(137, 209, 133, 0.2);
      border: 1px solid #89d185;
      color: #89d185;
    }

    .status.error {
      background: rgba(255, 107, 107, 0.2);
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ§¬ CodonCanvas Timeline Scrubber</h1>
      <div class="subtitle">Step-through execution visualization - watch your genome execute like a ribosome</div>
    </header>

    <div class="info-box">
      <h3>How to use:</h3>
      <p>
        1. Load an example or write your own genome<br>
        2. Click "Load & Execute" to process the genome<br>
        3. Use timeline controls to step through execution frame-by-frame<br>
        4. Watch the canvas update as each instruction executes<br>
        5. Observe the stack and current instruction in real-time
      </p>
    </div>

    <div id="statusContainer"></div>

    <div class="main-content">
      <div class="panel editor-section">
        <div class="panel-header">Genome Editor</div>
        <div class="panel-content">
          <div class="button-group">
            <button onclick="loadExample('helloCircle')">Hello Circle</button>
            <button onclick="loadExample('twoShapes')">Two Shapes</button>
            <button onclick="loadExample('colorfulPattern')">Colorful Pattern</button>
          </div>
          <textarea id="editor" placeholder="Enter genome here...">ATG GAA AAT GGA TAA</textarea>
          <div class="button-group">
            <button onclick="loadAndExecute()">ðŸš€ Load & Execute</button>
            <button class="secondary" onclick="clearCanvas()">Clear Canvas</button>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">Canvas Output</div>
        <div class="canvas-container">
          <canvas id="canvas" width="400" height="400"></canvas>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">Timeline Controls</div>
        <div class="panel-content">
          <div id="timelineContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { examples } from './src/examples.ts';
    import { TimelineScrubber, injectTimelineStyles } from './src/timeline-scrubber.ts';

    // Inject timeline styles
    injectTimelineStyles();

    const editor = document.getElementById('editor');
    const canvas = document.getElementById('canvas');
    const timelineContainer = document.getElementById('timelineContainer');
    const statusContainer = document.getElementById('statusContainer');

    let timeline = null;

    function showStatus(message, type = 'success') {
      statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
      setTimeout(() => {
        statusContainer.innerHTML = '';
      }, 5000);
    }

    window.loadExample = function(key) {
      if (examples[key]) {
        editor.value = examples[key].genome;
        showStatus(`Loaded: ${examples[key].title}`, 'success');
      }
    };

    window.loadAndExecute = function() {
      try {
        const genome = editor.value;

        // Destroy existing timeline if any
        if (timeline) {
          timeline.destroy();
        }

        // Create new timeline
        timeline = new TimelineScrubber({
          containerElement: timelineContainer,
          canvasElement: canvas,
          playbackSpeed: 500
        });

        // Load genome
        timeline.loadGenome(genome);

        showStatus('Genome loaded! Use timeline controls to step through execution.', 'success');

      } catch (error) {
        console.error('Load error:', error);
        showStatus(`Error: ${error.message}`, 'error');
      }
    };

    window.clearCanvas = function() {
      if (timeline) {
        timeline.destroy();
        timeline = null;
      }
      const ctx = canvas.getContext('2d');
      if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
      timelineContainer.innerHTML = '';
      showStatus('Canvas and timeline cleared', 'success');
    };

    // Auto-load on start
    window.loadAndExecute();
  </script>
</body>
</html>
